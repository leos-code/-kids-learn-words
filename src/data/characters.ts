export interface Character {
  id: number;
  char: string;
  pinyin: string;
  words: string[]; // 移除可选标记，确保必有词组
}

// 常用汉字拼音映射
const pinyinMap: { [key: string]: string } = {
  '八': 'bā', '把': 'bǎ', '爸': 'bà', '白': 'bái', '百': 'bǎi',
  '班': 'bān', '办': 'bàn', '半': 'bàn', '包': 'bāo', '饱': 'bǎo',
  '北': 'běi', '贝': 'bèi', '被': 'bèi', '本': 'běn', '比': 'bǐ',
  '边': 'biān', '别': 'bié', '不': 'bù', '才': 'cái', '草': 'cǎo',
  '册': 'cè', '长': 'cháng', '厂': 'chǎng', '吵': 'chǎo', '车': 'chē',
  '成': 'chéng', '吃': 'chī', '尺': 'chǐ', '虫': 'chóng', '出': 'chū',
  '穿': 'chuān', '船': 'chuán', '窗': 'chuāng', '床': 'chuáng', '春': 'chūn',
  '次': 'cì', '从': 'cóng', '打': 'dǎ', '大': 'dà', '但': 'dàn',
  '当': 'dāng', '刀': 'dāo', '到': 'dào', '道': 'dào', '的': 'de',
  '灯': 'dēng', '地': 'dì', '点': 'diǎn', '电': 'diàn', '东': 'dōng',
  '冬': 'dōng', '动': 'dòng', '都': 'dōu', '豆': 'dòu', '对': 'duì',
  '多': 'duō', '儿': 'ér', '耳': 'ěr', '二': 'èr', '发': 'fā',
  '反': 'fǎn', '饭': 'fàn', '方': 'fāng', '放': 'fàng', '飞': 'fēi',
  '分': 'fēn', '风': 'fēng', '干': 'gān', '高': 'gāo', '哥': 'gē',
  '个': 'gè', '给': 'gěi', '更': 'gèng', '工': 'gōng', '公': 'gōng',
  '共': 'gòng', '狗': 'gǒu', '瓜': 'guā', '关': 'guān', '光': 'guāng',
  '广': 'guǎng', '国': 'guó', '果': 'guǒ', '过': 'guò', '孩': 'hái',
  '海': 'hǎi', '好': 'hǎo', '合': 'hé', '和': 'hé', '河': 'hé',
  '很': 'hěn', '红': 'hóng', '后': 'hòu', '花': 'huā', '画': 'huà',
  '话': 'huà', '还': 'hái', '回': 'huí', '会': 'huì', '火': 'huǒ',
  '机': 'jī', '几': 'jǐ', '己': 'jǐ', '加': 'jiā', '家': 'jiā',
  '见': 'jiàn', '江': 'jiāng', '交': 'jiāo', '叫': 'jiào', '姐': 'jiě',
  '巾': 'jīn', '今': 'jīn', '金': 'jīn', '进': 'jìn', '京': 'jīng',
  '经': 'jīng', '九': 'jiǔ', '就': 'jiù', '军': 'jūn', '开': 'kāi',
  '看': 'kàn', '可': 'kě', '课': 'kè', '口': 'kǒu', '哭': 'kū',
  '快': 'kuài', '来': 'lái', '老': 'lǎo', '乐': 'lè', '里': 'lǐ',
  '力': 'lì', '立': 'lì', '脸': 'liǎn', '两': 'liǎng', '亮': 'liàng',
  '了': 'le', '林': 'lín', '六': 'liù', '妈': 'mā', '马': 'mǎ',
  '猫': 'māo', '毛': 'máo', '没': 'méi', '每': 'měi', '美': 'měi',
  '妹': 'mèi', '门': 'mén', '们': 'men', '米': 'mǐ', '面': 'miàn',
  '民': 'mín', '明': 'míng', '木': 'mù', '目': 'mù', '那': 'nà',
  '奶': 'nǎi', '你': 'nǐ', '年': 'nián', '鸟': 'niǎo', '牛': 'niú',
  '农': 'nóng', '女': 'nǚ', '胖': 'pàng', '跑': 'pǎo', '朋': 'péng',
  '皮': 'pí', '片': 'piàn', '票': 'piào', '平': 'píng', '七': 'qī',
  '奇': 'qí', '起': 'qǐ', '气': 'qì', '千': 'qiān', '前': 'qián',
  '青': 'qīng', '秋': 'qiū', '去': 'qù', '全': 'quán', '然': 'rán',
  '让': 'ràng', '人': 'rén', '日': 'rì', '三': 'sān', '山': 'shān',
  '上': 'shàng', '少': 'shǎo', '舌': 'shé', '身': 'shēn', '生': 'shēng',
  '声': 'shēng', '师': 'shī', '十': 'shí', '什': 'shén', '石': 'shí',
  '时': 'shí', '市': 'shì', '是': 'shì', '手': 'shǒu', '书': 'shū',
  '树': 'shù', '双': 'shuāng', '谁': 'shuí', '水': 'shuǐ', '说': 'shuō',
  '四': 'sì', '岁': 'suì', '他': 'tā', '她': 'tā', '台': 'tái',
  '太': 'tài', '天': 'tiān', '田': 'tián', '条': 'tiáo', '跳': 'tiào',
  '听': 'tīng', '同': 'tóng', '头': 'tóu', '土': 'tǔ', '外': 'wài',
  '玩': 'wán', '晚': 'wǎn', '万': 'wàn', '王': 'wáng', '网': 'wǎng',
  '为': 'wéi', '卫': 'wèi', '文': 'wén', '问': 'wèn', '我': 'wǒ',
  '五': 'wǔ', '午': 'wǔ', '西': 'xī', '习': 'xí', '洗': 'xǐ',
  '下': 'xià', '先': 'xiān', '现': 'xiàn', '向': 'xiàng', '小': 'xiǎo',
  '校': 'xiào', '笑': 'xiào', '些': 'xiē', '心': 'xīn', '兴': 'xīng',
  '星': 'xīng', '行': 'xíng', '学': 'xué', '雪': 'xuě', '牙': 'yá',
  '羊': 'yáng', '阳': 'yáng', '样': 'yàng', '要': 'yào', '爷': 'yé',
  '也': 'yě', '业': 'yè', '叶': 'yè', '页': 'yè', '一': 'yī',
  '衣': 'yī', '医': 'yī', '以': 'yǐ', '因': 'yīn', '阴': 'yīn',
  '音': 'yīn', '用': 'yòng', '有': 'yǒu', '又': 'yòu', '鱼': 'yú',
  '羽': 'yǔ', '雨': 'yǔ', '语': 'yǔ', '元': 'yuán', '月': 'yuè',
  '云': 'yún', '再': 'zài', '在': 'zài', '早': 'zǎo', '站': 'zhàn',
  '找': 'zhǎo', '这': 'zhè', '真': 'zhēn', '正': 'zhèng', '知': 'zhī',
  '直': 'zhí', '只': 'zhǐ', '中': 'zhōng', '竹': 'zhú', '主': 'zhǔ',
  '住': 'zhù', '桌': 'zhuō', '着': 'zhe', '子': 'zǐ', '字': 'zì',
  '自': 'zì', '走': 'zǒu', '作': 'zuò', '坐': 'zuò', '做': 'zuò'
};

// 常用词组映射
const wordGroupsMap: { [key: string]: string[] } = {
  '八': ['八个', '八月'],
  '把': ['把手', '把握'],
  '爸': ['爸爸', '爸妈'],
  '白': ['白色', '白云'],
  '百': ['一百', '百花'],
  '班': ['班级', '班长'],
  '办': ['办法', '办公'],
  '半': ['一半', '半天'],
  '包': ['书包', '包子'],
  '饱': ['吃饱', '饱了'],
  '北': ['北方', '北京'],
  '贝': ['贝壳', '宝贝'],
  '被': ['被子', '被动'],
  '本': ['书本', '本来'],
  '比': ['比较', '比赛'],
  '边': ['旁边', '一边'],
  '别': ['别人', '分别'],
  '不': ['不是', '不要'],
  '才': ['才能', '刚才'],
  '草': ['小草', '草地'],
  '册': ['画册', '手册'],
  '长': ['长大', '长江'],
  '厂': ['工厂', '厂房'],
  '吵': ['吵闹', '吵架'],
  '车': ['汽车', '火车'],
  '成': ['成功', '成长'],
  '吃': ['吃饭', '好吃'],
  '尺': ['尺子', '一尺'],
  '虫': ['虫子', '昆虫'],
  '出': ['出去', '出门'],
  '穿': ['穿衣', '穿过'],
  '船': ['小船', '轮船'],
  '窗': ['窗户', '开窗'],
  '床': ['床上', '起床'],
  '春': ['春天', '春节'],
  '次': ['一次', '下次'],
  '从': ['从前', '从来'],
  '打': ['打球', '打开'],
  '大': ['大家', '大人'],
  '但': ['但是', '不但'],
  '当': ['当时', '当然'],
  '刀': ['小刀', '刀子'],
  '到': ['来到', '到达'],
  '道': ['道路', '知道'],
  '的': ['好的', '我的'],
  '灯': ['电灯', '灯光'],
  '地': ['地方', '土地'],
  '点': ['一点', '点头'],
  '电': ['电话', '电视'],
  '东': ['东方', '东西'],
  '冬': ['冬天', '冬季'],
  '动': ['动物', '运动'],
  '都': ['都是', '都有'],
  '豆': ['豆子', '豆腐'],
  '对': ['对的', '对面'],
  '多': ['多少', '很多'],
  '儿': ['儿子', '女儿'],
  '耳': ['耳朵', '耳机'],
  '二': ['二个', '二月'],
  '发': ['发现', '头发'],
  '反': ['反对', '相反'],
  '饭': ['吃饭', '米饭'],
  '方': ['方向', '方法'],
  '放': ['放下', '放学'],
  '飞': ['飞机', '飞行'],
  '分': ['分开', '分数'],
  '风': ['大风', '风雨'],
  '干': ['干活', '干净'],
  '高': ['高兴', '高大'],
  '哥': ['哥哥', '大哥'],
  '个': ['一个', '个人'],
  '给': ['给你', '送给'],
  '更': ['更好', '更加'],
  '工': ['工作', '工人'],
  '公': ['公园', '公共'],
  '共': ['共同', '一共'],
  '狗': ['小狗', '狗狗'],
  '瓜': ['西瓜', '瓜子'],
  '关': ['关门', '关心'],
  '光': ['阳光', '光明'],
  '广': ['广场', '广播'],
  '国': ['国家', '中国'],
  '果': ['水果', '苹果'],
  '过': ['过去', '经过'],
  '孩': ['孩子', '小孩'],
  '海': ['大海', '海边'],
  '好': ['好人', '好看'],
  '合': ['合作', '合适'],
  '和': ['和平', '和气'],
  '河': ['小河', '河水'],
  '很': ['很好', '很多'],
  '红': ['红色', '红花'],
  '后': ['后面', '以后'],
  '花': ['花朵', '花园'],
  '画': ['画画', '图画'],
  '话': ['说话', '电话'],
  '还': ['还有', '还是'],
  '回': ['回家', '回来'],
  '会': ['开会', '学会'],
  '火': ['大火', '火柴'],
  '机': ['飞机', '手机'],
  '几': ['几个', '几天'],
  '己': ['自己', '知己'],
  '加': ['加入', '加法'],
  '家': ['家人', '回家'],
  '见': ['看见', '见面'],
  '江': ['长江', '江水'],
  '交': ['交通', '交流'],
  '叫': ['叫声', '叫醒'],
  '姐': ['姐姐', '大姐'],
  '巾': ['毛巾', '纸巾'],
  '今': ['今天', '今年'],
  '金': ['金子', '金色'],
  '进': ['进去', '前进'],
  '京': ['北京', '南京'],
  '经': ['经过', '经常'],
  '九': ['九个', '九月'],
  '就': ['就是', '就要'],
  '军': ['军人', '军队'],
  '开': ['开门', '开心'],
  '看': ['看见', '看书'],
  '可': ['可以', '可爱'],
  '课': ['上课', '下课'],
  '口': ['门口', '出口'],
  '哭': ['大哭', '哭声'],
  '快': ['快乐', '快速'],
  '来': ['来到', '回来'],
  '老': ['老师', '老人'],
  '乐': ['快乐', '音乐'],
  '里': ['里面', '家里'],
  '力': ['力气', '用力'],
  '立': ['站立', '立刻'],
  '脸': ['笑脸', '洗脸'],
  '两': ['两个', '两天'],
  '亮': ['明亮', '月亮'],
  '了': ['好了', '完了'],
  '林': ['树林', '森林'],
  '六': ['六个', '六月'],
  '妈': ['妈妈', '爸妈'],
  '马': ['小马', '马上'],
  '猫': ['小猫', '猫咪'],
  '毛': ['毛衣', '毛笔'],
  '没': ['没有', '没事'],
  '每': ['每天', '每次'],
  '美': ['美丽', '美好'],
  '妹': ['妹妹', '小妹'],
  '门': ['门口', '开门'],
  '们': ['我们', '你们'],
  '米': ['大米', '米饭'],
  '面': ['面条', '面包'],
  '民': ['人民', '农民'],
  '明': ['明天', '明白'],
  '木': ['树木', '木头'],
  '目': ['目的', '目标'],
  '那': ['那个', '那里'],
  '奶': ['牛奶', '奶奶'],
  '你': ['你们', '你的'],
  '年': ['新年', '今年'],
  '鸟': ['小鸟', '鸟儿'],
  '牛': ['小牛', '牛奶'],
  '农': ['农民', '农业'],
  '女': ['女孩', '女人'],
  '胖': ['胖胖', '发胖'],
  '跑': ['跑步', '快跑'],
  '朋': ['朋友', '小朋友'],
  '皮': ['皮肤', '皮球'],
  '片': ['一片', '照片'],
  '票': ['车票', '门票'],
  '平': ['平安', '和平'],
  '七': ['七个', '七月'],
  '奇': ['奇怪', '好奇'],
  '起': ['起来', '起床'],
  '气': ['天气', '生气'],
  '千': ['一千', '千万'],
  '前': ['前面', '前进'],
  '青': ['青年', '青春'],
  '秋': ['秋天', '秋季'],
  '去': ['出去', '回去'],
  '全': ['全部', '完全'],
  '然': ['然后', '自然'],
  '让': ['让开', '让座'],
  '人': ['人们', '人民'],
  '日': ['日子', '生日'],
  '三': ['三个', '三月'],
  '山': ['大山', '山水'],
  '上': ['上面', '上学'],
  '少': ['多少', '少年'],
  '舌': ['舌头', '舌尖'],
  '身': ['身体', '身边'],
  '生': ['学生', '生日'],
  '声': ['声音', '叫声'],
  '师': ['老师', '教师'],
  '十': ['十个', '十月'],
  '什': ['什么', '为什么'],
  '石': ['石头', '石子'],
  '时': ['时间', '小时'],
  '市': ['城市', '市场'],
  '是': ['是的', '不是'],
  '手': ['手指', '双手'],
  '书': ['书本', '看书'],
  '树': ['大树', '树木'],
  '双': ['一双', '双手'],
  '谁': ['是谁', '谁的'],
  '水': ['河水', '水果'],
  '说': ['说话', '说明'],
  '四': ['四个', '四月'],
  '岁': ['一岁', '岁数'],
  '他': ['他们', '他的'],
  '她': ['她们', '她的'],
  '台': ['讲台', '舞台'],
  '太': ['太阳', '太太'],
  '天': ['天空', '天气'],
  '田': ['田地', '水田'],
  '条': ['一条', '条件'],
  '跳': ['跳舞', '跳跃'],
  '听': ['听见', '听话'],
  '同': ['同学', '相同'],
  '头': ['头发', '点头'],
  '土': ['土地', '泥土'],
  '外': ['外面', '外国'],
  '玩': ['玩耍', '玩具'],
  '晚': ['晚上', '晚安'],
  '万': ['一万', '千万'],
  '王': ['国王', '王子'],
  '网': ['上网', '网络'],
  '为': ['为了', '因为'],
  '卫': ['卫生', '保卫'],
  '文': ['文化', '文章'],
  '问': ['问题', '问好'],
  '我': ['我们', '我的'],
  '五': ['五个', '五月'],
  '午': ['中午', '午饭'],
  '西': ['西方', '东西'],
  '习': ['学习', '练习'],
  '洗': ['洗手', '洗脸'],
  '下': ['下面', '下雨'],
  '先': ['先生', '先进'],
  '现': ['现在', '出现'],
  '向': ['方向', '向前'],
  '小': ['小孩', '小学'],
  '校': ['学校', '校园'],
  '笑': ['笑脸', '笑声'],
  '些': ['一些', '这些'],
  '心': ['心里', '开心'],
  '兴': ['高兴', '兴趣'],
  '星': ['星星', '星空'],
  '行': ['行走', '行动'],
  '学': ['学习', '学校'],
  '雪': ['下雪', '雪花'],
  '牙': ['牙齿', '刷牙'],
  '羊': ['小羊', '山羊'],
  '阳': ['太阳', '阳光'],
  '样': ['样子', '一样'],
  '要': ['需要', '重要'],
  '爷': ['爷爷', '老爷'],
  '也': ['也是', '也要'],
  '业': ['作业', '事业'],
  '叶': ['叶子', '树叶'],
  '页': ['页面', '书页'],
  '一': ['一个', '一天'],
  '衣': ['衣服', '上衣'],
  '医': ['医生', '医院'],
  '以': ['可以', '以后'],
  '因': ['因为', '原因'],
  '阴': ['阴天', '阴凉'],
  '音': ['声音', '音乐'],
  '用': ['使用', '有用'],
  '有': ['没有', '有的'],
  '又': ['又是', '又来'],
  '鱼': ['小鱼', '鱼儿'],
  '羽': ['羽毛', '羽翼'],
  '雨': ['下雨', '雨水'],
  '语': ['语言', '语文'],
  '元': ['一元', '元旦'],
  '月': ['月亮', '月份'],
  '云': ['白云', '云朵'],
  '再': ['再见', '再来'],
  '在': ['现在', '存在'],
  '早': ['早上', '早晨'],
  '站': ['站立', '车站'],
  '找': ['寻找', '找到'],
  '这': ['这个', '这里'],
  '真': ['真的', '认真'],
  '正': ['正确', '正在'],
  '知': ['知道', '知识'],
  '直': ['直接', '一直'],
  '只': ['一只', '只有'],
  '中': ['中间', '中国'],
  '竹': ['竹子', '竹叶'],
  '主': ['主人', '主要'],
  '住': ['居住', '住处'],
  '桌': ['桌子', '书桌'],
  '着': ['看着', '听着'],
  '子': ['儿子', '孩子'],
  '字': ['汉字', '写字'],
  '自': ['自己', '自然'],
  '走': ['走路', '行走'],
  '作': ['作业', '工作'],
  '坐': ['坐下', '请坐'],
  '做': ['做事', '做饭']
};

// 从文本文件读取的汉字列表
const commonWords = `八把爸白百班办半包饱北贝被本比边别不才草册长厂吵车成吃尺虫出穿船窗床春次从打大但当刀到道的灯地点电东冬动都豆对多儿耳二发反饭方放飞分风干高哥个给更工公共狗瓜关光广国果过孩海好合和河很红后花画话还会火机几己加家见江交叫姐巾今金进京经九就军开看可课口哭快来老乐里力立脸两亮了林六妈马猫毛没每美妹门们米面民明木目那奶你年鸟牛农女胖跑朋皮片票平七奇起气千前青秋去全然让人日三山上少舌身生声师十什石时市是手书树双谁水说四岁他她台太天田条跳听同头土外玩晚万王网为卫文问我五午西习洗下先现向小校笑些心兴星行学雪牙羊阳样要爷也业叶页一衣医以因阴音用有又鱼羽雨语元月云再在早站找这真正知直只中竹主住桌着子字自走作坐做`.split('');

// 按拼音排序的汉字列表
export const sortedCharacters: Character[] = commonWords
  .map((char, index) => ({
    id: index + 1,
    char,
    pinyin: pinyinMap[char] || char,
    words: wordGroupsMap[char] || [`${char}字`, `${char}的`] // 如果没有词组，提供默认词组
  }))
  .sort((a, b) => a.pinyin.localeCompare(b.pinyin, 'zh-CN'));

// 用户选择的汉字列表
export const selectedCharacters: Character[] = [];

const STORAGE_KEY = 'selected-characters';

export function saveSelectedCharacters(characters: Character[]) {
  try {
    localStorage.setItem(STORAGE_KEY, JSON.stringify(characters));
  } catch (error) {
    console.error('Failed to save selected characters:', error);
  }
}

export function getSelectedCharacters(): Character[] {
  try {
    const saved = localStorage.getItem(STORAGE_KEY);
    if (!saved) return [];
    
    const parsed = JSON.parse(saved);
    // 验证数据格式并过滤掉无效的字符
    return parsed.filter((char: unknown): char is Character => 
      typeof char === 'object' && 
      char !== null &&
      'id' in char && 
      'char' in char && 
      'pinyin' in char &&
      'words' in char &&
      typeof (char as Character).id === 'number' && 
      typeof (char as Character).char === 'string' && 
      typeof (char as Character).pinyin === 'string' &&
      Array.isArray((char as Character).words)
    );
  } catch (error) {
    console.error('Failed to load selected characters:', error);
    return [];
  }
}

export const getCurrentProgress = (): number => {
  const progress = localStorage.getItem(STORAGE_KEY);
  return progress ? parseInt(progress, 10) : 0;
};

export const saveProgress = (index: number): void => {
  localStorage.setItem(STORAGE_KEY, index.toString());
}; 